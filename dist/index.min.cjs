"use strict";var ut=Object.create;var E=Object.defineProperty;var ft=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var ht=Object.getPrototypeOf,pt=Object.prototype.hasOwnProperty;var gt=(r,t)=>{for(var e in t)E(r,e,{get:t[e],enumerable:!0})},L=(r,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ct(t))!pt.call(r,i)&&i!==e&&E(r,i,{get:()=>t[i],enumerable:!(o=ft(t,i))||o.enumerable});return r};var C=(r,t,e)=>(e=r!=null?ut(ht(r)):{},L(t||!r||!r.__esModule?E(e,"default",{value:r,enumerable:!0}):e,r)),dt=r=>L(E({},"__esModule",{value:!0}),r);var zt={};gt(zt,{PROVIDER:()=>Nt,close:()=>Ft,createURL:()=>Dt,getBook:()=>Wt,getChapter:()=>_t,getMetadata:()=>qt,parseURL:()=>Yt,setCacheDir:()=>Rt});module.exports=dt(zt);var W=C(require("dayjs"),1);var R=C(require("cheerio"),1),q=C(require("puppeteer-extra"),1),et=C(require("puppeteer-extra-plugin-stealth"),1),rt=require("tough-cookie"),nt=C(require("fetch-cookie"),1);function mt(r){return typeof r=="boolean"}function I(r){return typeof r=="number"&&!Number.isNaN(r)&&Number.isFinite(r)}function S(r){return typeof r=="string"}function $(r){return typeof r=="object"&&r!==null&&!A(r)}function A(r){return Array&&Array.isArray?Array.isArray(r):Object.prototype.toString.call(r)==="[object Array]"}function yt(r){return typeof r=="function"}function Q(r,t,e){return r-=t,e-=t,r<0&&(r=r%e+e),r>=e&&(r=r%e),r+t}function O(r){return r.replace(/[！-～]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)}).replace(/[^\S\r\n]/g," ")}function wt(r){let t=r.split("/"),e=t.pop(),o=t.slice(1,t.length).join("/");return new RegExp(o,e)}function Y(r){let t={};for(let[e,o]of Object.entries(r))$(o)?t[e]=Y(o):A(o)?t[e]=X(o):t[e]=o;return t}function U(r,t){function e(a,n){if($(n)){for(let[s,l]of Object.entries(n))if(!o(a,l,s.split(".")))return!1;return!0}else return i(a,n,"$eq")}function o(a,n,s){let l=s.shift();return s.length>0?$(a)&&S(l)?o(a[l],n,s):!1:S(l)?i(a,n,l):!1}function i(a,n,s){if(s==="$and"){if(!A(n))throw new Error(`Invalid query type: ${typeof n}`);for(let l of n)if(!e(a,l))return!1;return!0}else{if(s==="$nand")return!i(a,n,"$and");if(s==="$or"){if(!A(n))throw new Error(`Invalid query type: ${typeof n}`);for(let l of n)if(e(a,l))return!0;return!1}else{if(s==="$nor")return!i(a,n,"$or");if(s==="$not")return!e(a,n);if(s==="$in"){if(!A(n))throw new Error(`Invalid query type: ${typeof n}`);for(let l of n)if(i(a,l,"$eq"))return!0;return!1}else{if(s==="$nin")return!i(a,n,"$in");if(s==="$gt"){if(!I(n))throw new Error(`Invalid query type: ${typeof n}`);return a>n}else if(s==="$gte"){if(!I(n))throw new Error(`Invalid query type: ${typeof n}`);return a>=n}else if(s==="$lt"){if(!I(n))throw new Error(`Invalid query type: ${typeof n}`);return a<n}else if(s==="$lte"){if(!I(n))throw new Error(`Invalid query type: ${typeof n}`);return a<=n}else if(s==="$eq")if(A(a)&&A(n)){if(a.length!==n.length)return!1;for(let l in n)if(!i(a[l],n[l],"$eq"))return!1;return!0}else return $(n)?e(a,n):a===n;else{if(s==="$ne")return!i(a,n,"$eq");if(s==="$exists"){if(!mt(n))throw new Error(`Invalid query type: ${typeof n}`);return a!=null===n}else if(s==="$elemMatch"){if(!$(n))throw new Error(`Invalid query type: ${typeof n}`);if(!A(a))return!1;for(let l of a)if(!e(l,n))return!1;return!0}else if(s==="$mod"){if(!A(n))throw new Error(`Invalid query type: ${typeof n}`);let l=n[0],u=n[1];if(!I(l))throw new Error(`Invalid divisor type: ${typeof l}`);if(!I(u))throw new Error(`Invalid remainder type: ${typeof u}`);return a%l===u}else{if(s==="$size")return A(a)?e(a.length,n):$(a)?e(Object.keys(a).length,n):!1;if(s==="$function"){if(!yt(n))throw new Error(`Invalid query type: ${typeof n}`);return n(a)}else if(s==="$regex"){if(S(n))return n.charAt(0)==="/"?wt(n).test(a):new RegExp(n).test(a);if(n instanceof RegExp)return n.test(a);throw new Error(`Invalid query type: ${typeof n}`)}else if(/^\$-?[0-9]+$/.test(s)){let l=Math.floor(Q(parseInt(s.substring(1)),0,a.length));return e(a[l],n)}else return $(a)?$(n)?e(a[s],n):i(a[s],n,"$eq"):!1}}}}}}return e(r,t)}function xt(r,t){for(let e of Object.keys(t))for(let[o,i]of Object.entries(t[e])){let a=o.split("."),n=a.pop();if(!S(n))continue;let s=r;for(;$(s);){let l=a.shift();if(!l)break;s=s[l]}if($(s)){if(e==="$set")s[n]=i;else if(e==="$unset")i&&delete s[n];else if(e==="$push")s[n].push(i);else if(e==="$pushAll"){if(Array.isArray(i))for(let l of i)s[n].push(l)}else if(e==="$pull"){for(let l=s[n].length;l>=0;l--)if(s[n][l]===i){s[n].splice(l,1);break}}else if(e==="$pullAll")Array.isArray(i)&&(s[n]=s[n].filter(function(l){for(let u of i)if(l===u)return!1;return!0}));else if(e==="$addToSet"){let l=!1;for(let u of s[n])if(u===i){l=!0;break}l||s[n].push(i)}else if(e==="$addToSetAll"&&Array.isArray(i))for(let l of i){let u=!1;for(let c of s[n])if(c===l){u=!0;break}u||s[n].push(l)}}}return r}function X(r){let t=[];for(let e=0;e<r.length;e++){let o=r[e];$(o)?r[e]=Y(o):A(o)?r[e]=X(o):r[e]=o}return t}function M(r){return new Promise(function(t){return setTimeout(t,r)})}var v=[["&","&amp;"],[" ","&nbsp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"],["\xA2","&cent;"],["\xA3","&pound;"],["\xA5","&yen;"],["\u20AC","&euro;"],["\xA9","&copy;"],["\xAE","&reg;"]],N=[["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"]];function $t(r){return r.replace(/\r\n/g,`
`)}function At(r){return r.replace(/^</,"").replace(/([^<][!?/])?>$/,"").replace(/\s+/g," ").trim()}function bt(r,t){for(let e=r.length-1;e>=0;e--)if(t(r[e],e,r))return e;return-1}function j(r){return encodeURIComponent(r)}function tt(r){return decodeURIComponent(r)}function Ct(r){for(let t=0;t<v.length;t++)r=r.replace(new RegExp(v[t][0],"g"),v[t][1]);return r}function G(r){for(let t=v.length-1;t>=0;t--)r=r.replace(new RegExp(v[t][1],"g"),v[t][0]);return r}function It(r){for(let t=0;t<N.length;t++)r=r.replace(new RegExp(N[t][0],"g"),N[t][1]);return r}function vt(r){return r.replace(/<!--([\s\S]*?)-->/g,function(...t){return`<!-->${j(t[1])}</!-->`})}function Ot(r){return r.replace(/(<script(?:[\s\S]*?)>)([\s\S]*?)(<\/script>)/g,function(...t){return`${t[1]}${j(t[2])}${t[3]}`})}function Mt(r){return r.replace(/(<style(?:[\s\S]*?)>)([\s\S]*?)(<\/style>)/g,function(...t){return`${t[1]}${j(t[2])}${t[3]}`})}function Et(r){return r.replace(/(>)([\s\S]*?)(<)/g,function(...t){return`${t[1]}${Ct(t[2])}${t[3]}`})}function St(r){function t(...e){return`=${j(e[1])} `}return r.replace(/='([^'>]*?)'/g,t).replace(/="([^">]*?)"/g,t)}function jt(r,t){let e=t.split("="),o=e.shift();o&&(e.length===0?r[o]=!0:r[o]=tt(e.join("=")))}function Bt(r){let t=At(r).split(/\s/),e={tag:t[0]||"",attributes:{},children:[],isClosing:!1,isClosed:!1,isEncoded:!1};typeof e.tag=="string"&&(e.isClosing=/^\//.test(e.tag),e.isClosed=e.isClosing,e.tag=e.tag.replace(/^\//,""),!e.isClosing&&["script","style","!--"].indexOf(e.tag)>-1&&(e.isEncoded=!0));for(let o=1;o<t.length;o++)jt(e.attributes,t[o]);return e}function kt(r){let t="";for(let[e,o]of Object.entries(r))typeof o=="string"?t+=` ${e}="${It(o)}"`:o===!0&&(t+=` ${e}`);return t}function V(r){r=St(Et(Mt(Ot(vt($t(r))))));let t=0,e=/<[^>]*?>/g,o,i=[],a=[],n;for(;o=e.exec(r);){if(t!==o.index){let s=r.substring(t,o.index);i.push({content:G(s)})}if(n=Bt(o[0]),!n.isClosing)i.push(n),a.push(n);else{let s=bt(i,function(l){return!l.isClosed&&l.tag===n.tag});if(s>-1){let l=i[s];l.isClosed=!0,l.children=i.splice(s+1,i.length-s+1)}}t=e.lastIndex}if(t<r.length){let s=r.substring(t);i.push({content:G(s)})}for(let s of a){if(s.tag&&(s.tag.toUpperCase()==="!DOCTYPE"?s.closer="":s.tag.toLowerCase()==="?xml"?s.closer="?":s.tag==="!--"?s.closer="--":s.isClosed||(s.closer=" /"),s.isEncoded&&s.children))for(let l of s.children)l.content&&(l.content=tt(l.content));delete s.isClosed,delete s.isClosing,delete s.isEncoded}return{children:i}}function K(r,t){let e=0,o=function(i){let{tag:a,closer:n,attributes:s,content:l}=t?t(i,e):i,u="";if(e++,typeof a=="string"){if(u+=`<${a}`,typeof s=="object"&&(u+=kt(s)),typeof n!="string"&&(u+=">"),Array.isArray(i.children))for(let c of i.children)u+=o(c);typeof n!="string"?u+=`</${a}>`:u+=`${n}>`}else if(typeof l=="string")u=l;else if(Array.isArray(i.children))for(let c of i.children)u+=o(c);return u};return o(r)}function J(r){let t=function(e){let o=e.split(/([>\s])/).map(n=>n?.trim()).filter(Boolean),i=[],a;for(let n of o){if(n===">"){a=n;continue}let s=a&&a===">"?1:void 0,l={$and:[]},u=n.match(/^([a-zA-Z0-9]+)/),c=[...n.matchAll(/#([a-zA-Z0-9_-]+)/g)],d=[...n.matchAll(/\.([a-zA-Z0-9_-]+)/g)],w=[...n.matchAll(/\[([a-zA-Z0-9_-]+)([*^$]?=["']?([^"']+)["']?)?\]/g)];if(u){let f=u[1];f!=="*"?l.$and.push({tag:f}):l.$and.push({tag:{$regex:f}})}if(c.length>0)for(let f of c)l.$and.push({"attributes.id":{$regex:"(^| )("+f[1]+")( |$)"}});if(d.length>0)for(let f of d)l.$and.push({"attributes.class":{$regex:"(^| )("+f[1]+")( |$)"}});if(w.length>0)for(let f of w){let h=f[1],y=f[2]?f[2][0]:null,g=f[3],x={};y?y==="="?x["attributes."+h]=g:y==="^"?x["attributes."+h]={$regex:`^${g}`}:y==="$"?x["attributes."+h]={$regex:`${g}$`}:y==="*"&&(x["attributes."+h]={$regex:g}):x["attributes."+h]={$exists:!0},l.$and.push(x)}s?i.push({query:l,depth:s}):i.push({query:l}),a=n}return i};return r.split(",").map(e=>e.trim()).filter(Boolean).map(e=>t(e))}var Zt=class D{constructor(t){this.children=[],typeof t=="string"&&(t=V(t)),Object.assign(this,t),this.children=this.prepare(this.children)}getContent(){let t="";if(typeof this.content=="string")t+=this.content;else for(let e of this.children)t+=e.getContent();return t}setContent(t){return this.children=this.prepare([{content:t}]),this}findOne(t,e=Number.POSITIVE_INFINITY){if(!(e<1))for(let o of this.children){if(U(o,t))return o;let i=o.findOne(t,e-1);if(i)return i}}findMany(t,e=Number.POSITIVE_INFINITY){let o=[];if(e<1)return o;for(let i of this.children){U(i,t)&&o.push(i);let a=i.findMany(t,e-1);o.push(...a)}return o}querySelector(t){let e=J(t);for(let o of e){let i=[this];for(let{query:a,depth:n}of o)i=i.reduce((s,l)=>[...s,...l.findMany(a,n)],[]);if(i[0])return i[0]}}querySelectorAll(t){let e=J(t),o=[];for(let i of e){let a=[this];for(let{query:n,depth:s}of i)a=a.reduce((l,u)=>[...l,...u.findMany(n,s)],[]);o.push(...a)}return o=o.filter((i,a,n)=>n.findIndex(s=>i==s)===a),o}update(t){return xt(this,t),this.children=this.prepare(this.children),this}updateOne(t,e){let o=this.findOne(t);return o&&o.update(e),this}updateMany(t,e){let o=this.findMany(t);for(let i of o)i.update(e);return this}prepare(t){return t.map(e=>{if(e instanceof D)return e.parent=this,e;{let o=new D(e);return o.parent=this,o}})}replace(...t){return this.children=this.prepare(t),this}append(...t){return this.children=this.children.concat(this.prepare(t)),this}prepend(...t){return this.children.splice(0,0,...this.prepare(t)),this}insert(t,...e){return t=Math.floor(Q(t,0,this.children.length)),this.children.splice(t,0,...this.prepare(e)),this}toObject(){let t=Y(this);return delete t.parent,t.children=this.children.map(e=>e.toObject()),t}toString(t){return K(this,t)}static{this.parse=V}static{this.stringify=K}};q.default.use((0,et.default)());var _=new rt.CookieJar;_.setCookieSync("over18=yes","https://novel18.syosetu.com/");_.setCookieSync("over18=off","https://syosetu.org/");var Tt=(0,nt.default)(fetch,_);async function ot(r,t,e=0){let o=0;for(;o<=e;){let i=await r.$(t);if(i)return i;await M(256),o+=256}throw new Error(`Element not found: ${t}`)}async function Pt(r,t,e=0){let o=await ot(r,t,e);return await r.evaluate(a=>a?.textContent,o)}async function it(r,t,e=0){await ot(r,t,e),await r.click(t)}async function st(r,t,e,o=0){let i=0;for(;i<=o;){let a=await Pt(r,t);if(a&&e(a))return a;await M(256),i+=256}throw new Error(`Content not found: ${t}`)}var b=class{constructor(t){this.isOpened=!1,this.cacheDir=".puppeteer",Object.assign(this,t)}async open(){for(this.isOpened||(this.isOpened=!0,this.browser=await q.default.launch({userDataDir:this.cacheDir}));!this.browser;)await M(128)}async close(){if(this.isOpened){for(;!this.browser;)await M(128);let t=this.browser;this.browser=void 0,this.isOpened=!1,await t.close()}}async load(t,e,o){if(e||(e=[]),await this.open(),!this.browser)throw new Error("Browser not found");let i=await this.browser.newPage();try{await i.goto(t,this.pageOptions);for(let s of e){let l=setTimeout(()=>{throw new Error(`Element not found: ${s}`)},1e4);await i.waitForSelector(s,{visible:!0,timeout:0}),clearTimeout(l)}o&&await o(i);let a=await i.content(),n=R.load(a);return await i.close(),n}catch(a){throw await i.close(),a}}async fetch(t,e){let o=await Tt(t,e);if(!o.ok)throw new Error("Fetching failed");let i=await o.text();return R.load(i)}};function at(r){return typeof r=="number"?r:typeof r=="string"?isNaN(parseInt(r))?0:parseInt(r):0}function p(r){return O(r.find("br").replaceWith(`
`).end().text()).trim()}var B=class extends b{constructor(t){super(t)}async getMetadata(t,e){let o=`https://www.alphapolis.co.jp/novel/${t}/${e}`,i=await this.fetch(o),a=i("table.detail"),n=function(x){return p(a.find("th").filter(function(){return i(this).text().trim()===x}).next())},s=/連載中/.test(p(i(".content-statuses").first())),l=p(i("h1.title")),u=p(i(".author")),c=p(i(".abstract").first()),d=n("\u521D\u56DE\u516C\u958B\u65E5\u6642").replace(/[^0-9]/g,""),w=n("\u66F4\u65B0\u65E5\u6642").replace(/[^0-9]/g,""),f=d.length===12?(0,W.default)(d,"YYYYMMDDHHmm").valueOf():0,h=w.length===12?(0,W.default)(w,"YYYYMMDDHHmm").valueOf():0,y=[];for(let x of i("div.episode a").toArray()){let H=x.attribs.href,Z=H.split("/").pop();if(!Z)throw new Error(`ChapterID not found: ${H}`);y.push(Z)}let g={onGoing:s,title:l,outline:c,author:u,chapterIds:y,createdAt:f,updatedAt:h};if(g.title===""||g.author==="")throw new Error("Metadata not found");return g}async getChapter(t,e,o){let i=`https://www.alphapolis.co.jp/novel/${t}/${e}/episode/${o}`,a=await this.load(i,null,async u=>{let c=0;for(;c<10;){c++;try{await it(u,"#TopLayer",0)}catch{}try{await st(u,"#novelBody",d=>O(d).trim()!=="",1e3);return}catch{}}throw new Error("Content not found")}),n=p(a(".episode-title")),s=a("#novelBody").find("br").replaceWith(`
`).end().text();return{id:o,title:n,content:s}}async getBook(t,e,o){let i=await this.getMetadata(t,e),a=[],n=i.chapterIds.length;for(let l=0;l<n;l++)try{let u=i.chapterIds[l],c=await this.getChapter(t,e,u);a.push(c),o&&o(null,c,l,n)}catch(u){o&&o(u,null,l,n)}return{...i,chapters:a}}};var F=C(require("dayjs"),1);var k=class extends b{constructor(t){super(t)}async getMetadata(t){let e=`https://syosetu.org/?mode=ss_detail&nid=${t}`,o=await this.fetch(e),i=function(g){return p(o("td").filter(function(){return o(this).text().trim()===g}).next())},a=!/短編|完結/.test(i("\u8A71\u6570")),n=i("\u30BF\u30A4\u30C8\u30EB"),s=i("\u4F5C\u8005"),l=i("\u3042\u3089\u3059\u3058"),u=parseInt(i("\u8A71\u6570").replace(/[^0-9]/g,"")),c=i("\u63B2\u8F09\u958B\u59CB").replace(/[^0-9]/g,""),d=i("\u6700\u65B0\u6295\u7A3F").replace(/[^0-9]/g,""),w=c.length===12?(0,F.default)(c,"YYYYMMDDHHmm").valueOf():0,f=d.length===12?(0,F.default)(d,"YYYYMMDDHHmm").valueOf():0,h=[];for(let g=0;g<u;g++)h.push(""+(g+1));let y={onGoing:a,title:n,outline:l,author:s,chapterIds:h,createdAt:w,updatedAt:f};if(y.title===""||y.author==="")throw new Error("Metadata not found");return y}async getChapter(t,e){let o=`https://syosetu.org/novel/${t}/${e}.html`,i=await this.fetch(o),a=p(i("#analytics_start").prev()),n=0,s=i(`#${n}`),l=[];for(;s.length!==0;)l.push(s.text()),n++,s=i(`#${n}`);return{id:e,title:a,content:l.join(`
`)}}async getBook(t,e){let o=await this.getMetadata(t),i=[],a=o.chapterIds.length;for(let s=0;s<a;s++)try{let l=o.chapterIds[s],u=await this.getChapter(t,l);i.push(u),e&&e(null,u,s,a)}catch(l){e&&e(l,null,s,a)}return{...o,chapters:i}}};var lt=C(require("dayjs"),1);var T=class extends b{constructor(t){super(t)}async getMetadata(t){let e=`https://kakuyomu.jp/works/${t}`,o=await this.fetch(e),i=p(o("a[title]").first()),a=p(o(".CollapseTextWithKakuyomuLinks_collapseText__XSlmz")),n=p(o('a[href^="/users"]').first()),s=!1;for(let f of o(".Meta_metaItem__8eZTP").toArray()){let h=o(f).text();if(h.indexOf("\u9023\u8F09\u4E2D")>-1){s=!0;break}else if(h.indexOf("\u5B8C\u7D50\u6E08")>-1){s=!1;break}}let l=0,u=0,c=[],d=JSON.parse(o("#__NEXT_DATA__").text());for(let f of Object.values(d.props.pageProps.__APOLLO_STATE__))if($(f)&&f.__typename==="Episode"){let h=(0,lt.default)(f.publishedAt).valueOf();l?l>h&&(l=h):l=h,u?u<h&&(u=h):u=h,c.push({id:f.id,publishedAt:h})}let w={onGoing:s,title:i,outline:a,author:n,chapterIds:c.map(f=>f.id),createdAt:l,updatedAt:u};if(w.title===""||w.author==="")throw new Error("Metadata not found");return w}async getChapter(t,e){let o=`https://kakuyomu.jp/works/${t}/episodes/${e}`,i=await this.fetch(o),a=p(i("#contentMain-header .widget-episodeTitle")),n=1,s=i(`#p${n}`),l=[];for(;s.length!==0;)l.push(s.text()),n++,s=i(`#p${n}`);return{id:e,title:a,content:l.join(`
`)}}async getBook(t,e){let o=await this.getMetadata(t),i=[],a=o.chapterIds.length;for(let s=0;s<a;s++)try{let l=o.chapterIds[s],u=await this.getChapter(t,l);i.push(u),e&&e(null,u,s,a)}catch(l){e&&e(l,null,s,a)}return{...o,chapters:i}}};var z=C(require("dayjs"),1);var P=class extends b{constructor(t){super(t)}async getMetadata(t){let e=`https://ncode.syosetu.com/novelview/infotop/ncode/${t}/`,o=await this.fetch(e),i=!1,a=!0,n=p(o("#pre_info"));n.indexOf("\u77ED\u7DE8")>-1?(i=!0,a=!1):n.indexOf("\u5B8C\u7D50\u6E08")>-1?(i=!1,a=!1):(i=!1,a=!0);let s=p(o("#contents_main > h1 > a")),l=p(o("#noveltable1 tbody tr:nth-child(2) td")),u=p(o("#noveltable1 tbody tr:nth-child(1) td")),c=p(o("#noveltable2 tbody tr:nth-child(1) td")).replace(/[^0-9]/g,""),d=p(o("#noveltable2 tbody tr:nth-child(2) td")).replace(/[^0-9]/g,""),w=c.length===12?(0,z.default)(c,"YYYYMMDDHHmm").valueOf():0,f=i?w:d.length===12?(0,z.default)(d,"YYYYMMDDHHmm").valueOf():0,h=at(O(o("#pre_info").text()).match(/全([0-9]+)エピソード/)?.[1]||""),y=[];if(i)y.push("");else for(let x=0;x<h;x++)y.push(""+(x+1));let g={onGoing:a,title:s,outline:u,author:l,chapterIds:y,createdAt:w,updatedAt:f};if(g.title===""||g.author==="")throw new Error("Metadata not found");return g}async getChapter(t,e){let o=e===""?`https://ncode.syosetu.com/${t}`:`https://ncode.syosetu.com/${t}/${e}`,i=await this.fetch(o),a=p(i("h1.p-novel__title")),n=1,s=i(`#L${n}`),l=[];for(;s.length!==0;)l.push(s.text()),n++,s=i(`#L${n}`);return{id:e,title:a,content:l.join(`
`)}}async getBook(t,e){let o=await this.getMetadata(t),i=[],a=o.chapterIds.length;for(let s=0;s<a;s++)try{let l=o.chapterIds[s],u=await this.getChapter(t,l);i.push(u),e&&e(null,u,s,a)}catch(l){e&&e(l,null,s,a)}return{...o,chapters:i}}};var Nt={NAROU:"narou",KAKUYOMU:"kakuyomu",ALPHAPOLIS:"alphapolis",HAMELN:"hameln"};function Dt(r,t,e){let o="";if(r==="narou")o=`https://ncode.syosetu.com/${t}/`,e&&e!==""&&(o+=`${e}`);else if(r==="narou18")o=`https://novel18.syosetu.com/${t}/`,e&&(o+=`${e}`);else if(r==="kakuyomu")o=`https://kakuyomu.jp/works/${t}`,e&&(o+=`/episodes/${e}`);else if(r==="hameln")o=`https://syosetu.org/novel/${t}/`,e&&(o+=`${e}.html`);else if(r==="alphapolis")o=`https://www.alphapolis.co.jp/novel/${t}/`,e&&(o+=`episode/${e}`);else throw new Error(`Invalid provider: ${r}`);return o}function Yt(r){let t=[["narou",/^https?:\/\/(?:www\.)?ncode\.syosetu\.com\/(?!novelview)([^/]+)(?:$|\/)/],["narou",/^https?:\/\/(?:www\.)?novel18\.syosetu\.com\/(?!novelview)([^/]+)(?:$|\/)/],["kakuyomu",/^https?:\/\/(?:www\.)?kakuyomu\.jp\/works\/([^/]+)(?:$|\/)/],["hameln",/^https?:\/\/(?:www\.)?syosetu.org\/novel\/([^/]+)(?:$|\/)/],["alphapolis",/^https?:\/\/(?:www\.)?alphapolis\.co\.jp\/novel\/([^/]+\/[^/]+)(?:$|\/)/]],e=r.split(/\s/).map(i=>i.trim()).filter(Boolean),o=[];for(let i of e)for(let[a,n]of t)if(n.test(i)){let s=i.match(n);if(!s||!s[0]||!s[1])continue;let l=s[0];a==="kakuyomu"&&(l=l.replace(/\/$/,"")),o.push({url:l,provider:a,id:s[1]})}return o}var m={narou:new P,kakuyomu:new T,alphapolis:new B,hameln:new k};async function Rt(r){m.narou.cacheDir=r,m.kakuyomu.cacheDir=r,m.alphapolis.cacheDir=r,m.hameln.cacheDir=r}async function qt(r,t){if(r==="narou")return await m.narou.getMetadata(t);if(r==="kakuyomu")return await m.kakuyomu.getMetadata(t);if(r==="alphapolis")return await m.alphapolis.getMetadata(t.split("/")[0],t.split("/")[1]);if(r==="hameln")return await m.hameln.getMetadata(t);throw new Error(`Invalid provider: ${r}`)}async function _t(r,t,e){if(r==="narou")return await m.narou.getChapter(t,e);if(r==="kakuyomu")return await m.kakuyomu.getChapter(t,e);if(r==="alphapolis")return await m.alphapolis.getChapter(t.split("/")[0],t.split("/")[1],e);if(r==="hameln")return await m.hameln.getChapter(t,e);throw new Error(`Invalid provider: ${r}`)}async function Wt(r,t,e){if(r==="narou")return await m.narou.getBook(t,e);if(r==="kakuyomu")return await m.kakuyomu.getBook(t,e);if(r==="alphapolis")return await m.alphapolis.getBook(t.split("/")[0],t.split("/")[1],e);if(r==="hameln")return await m.hameln.getBook(t,e);throw new Error(`Invalid provider: ${r}`)}async function Ft(){for(let r of Object.values(m))await r.close()}0&&(module.exports={PROVIDER,close,createURL,getBook,getChapter,getMetadata,parseURL,setCacheDir});
