import X from"dayjs";import*as D from"cheerio";import G from"puppeteer-extra";import xt from"puppeteer-extra-plugin-stealth";import{CookieJar as $t}from"tough-cookie";import At from"fetch-cookie";function rt(n){return typeof n=="boolean"}function C(n){return typeof n=="number"&&!Number.isNaN(n)&&Number.isFinite(n)}function O(n){return typeof n=="string"}function w(n){return typeof n=="object"&&n!==null&&!A(n)}function A(n){return Array&&Array.isArray?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"}function nt(n){return typeof n=="function"}function Z(n,t,e){return n-=t,e-=t,n<0&&(n=n%e+e),n>=e&&(n=n%e),n+t}function v(n){return n.replace(/[！-～]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)}).replace(/[^\S\r\n]/g," ")}function ot(n){let t=n.split("/"),e=t.pop(),r=t.slice(1,t.length).join("/");return new RegExp(r,e)}function N(n){let t={};for(let[e,r]of Object.entries(n))w(r)?t[e]=N(r):A(r)?t[e]=L(r):t[e]=r;return t}function _(n,t){function e(a,o){if(w(o)){for(let[i,l]of Object.entries(o))if(!r(a,l,i.split(".")))return!1;return!0}else return s(a,o,"$eq")}function r(a,o,i){let l=i.shift();return i.length>0?w(a)&&O(l)?r(a[l],o,i):!1:O(l)?s(a,o,l):!1}function s(a,o,i){if(i==="$and"){if(!A(o))throw new Error(`Invalid query type: ${typeof o}`);for(let l of o)if(!e(a,l))return!1;return!0}else{if(i==="$nand")return!s(a,o,"$and");if(i==="$or"){if(!A(o))throw new Error(`Invalid query type: ${typeof o}`);for(let l of o)if(e(a,l))return!0;return!1}else{if(i==="$nor")return!s(a,o,"$or");if(i==="$not")return!e(a,o);if(i==="$in"){if(!A(o))throw new Error(`Invalid query type: ${typeof o}`);for(let l of o)if(s(a,l,"$eq"))return!0;return!1}else{if(i==="$nin")return!s(a,o,"$in");if(i==="$gt"){if(!C(o))throw new Error(`Invalid query type: ${typeof o}`);return a>o}else if(i==="$gte"){if(!C(o))throw new Error(`Invalid query type: ${typeof o}`);return a>=o}else if(i==="$lt"){if(!C(o))throw new Error(`Invalid query type: ${typeof o}`);return a<o}else if(i==="$lte"){if(!C(o))throw new Error(`Invalid query type: ${typeof o}`);return a<=o}else if(i==="$eq")if(A(a)&&A(o)){if(a.length!==o.length)return!1;for(let l in o)if(!s(a[l],o[l],"$eq"))return!1;return!0}else return w(o)?e(a,o):a===o;else{if(i==="$ne")return!s(a,o,"$eq");if(i==="$exists"){if(!rt(o))throw new Error(`Invalid query type: ${typeof o}`);return a!=null===o}else if(i==="$elemMatch"){if(!w(o))throw new Error(`Invalid query type: ${typeof o}`);if(!A(a))return!1;for(let l of a)if(!e(l,o))return!1;return!0}else if(i==="$mod"){if(!A(o))throw new Error(`Invalid query type: ${typeof o}`);let l=o[0],u=o[1];if(!C(l))throw new Error(`Invalid divisor type: ${typeof l}`);if(!C(u))throw new Error(`Invalid remainder type: ${typeof u}`);return a%l===u}else{if(i==="$size")return A(a)?e(a.length,o):w(a)?e(Object.keys(a).length,o):!1;if(i==="$function"){if(!nt(o))throw new Error(`Invalid query type: ${typeof o}`);return o(a)}else if(i==="$regex"){if(O(o))return o.charAt(0)==="/"?ot(o).test(a):new RegExp(o).test(a);if(o instanceof RegExp)return o.test(a);throw new Error(`Invalid query type: ${typeof o}`)}else if(/^\$-?[0-9]+$/.test(i)){let l=Math.floor(Z(parseInt(i.substring(1)),0,a.length));return e(a[l],o)}else return w(a)?w(o)?e(a[i],o):s(a[i],o,"$eq"):!1}}}}}}return e(n,t)}function it(n,t){for(let e of Object.keys(t))for(let[r,s]of Object.entries(t[e])){let a=r.split("."),o=a.pop();if(!O(o))continue;let i=n;for(;w(i);){let l=a.shift();if(!l)break;i=i[l]}if(w(i)){if(e==="$set")i[o]=s;else if(e==="$unset")s&&delete i[o];else if(e==="$push")i[o].push(s);else if(e==="$pushAll"){if(Array.isArray(s))for(let l of s)i[o].push(l)}else if(e==="$pull"){for(let l=i[o].length;l>=0;l--)if(i[o][l]===s){i[o].splice(l,1);break}}else if(e==="$pullAll")Array.isArray(s)&&(i[o]=i[o].filter(function(l){for(let u of s)if(l===u)return!1;return!0}));else if(e==="$addToSet"){let l=!1;for(let u of i[o])if(u===s){l=!0;break}l||i[o].push(s)}else if(e==="$addToSetAll"&&Array.isArray(s))for(let l of s){let u=!1;for(let c of i[o])if(c===l){u=!0;break}u||i[o].push(l)}}}return n}function L(n){let t=[];for(let e=0;e<n.length;e++){let r=n[e];w(r)?n[e]=N(r):A(r)?n[e]=L(r):n[e]=r}return t}function E(n){return new Promise(function(t){return setTimeout(t,n)})}var I=[["&","&amp;"],[" ","&nbsp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"],["\xA2","&cent;"],["\xA3","&pound;"],["\xA5","&yen;"],["\u20AC","&euro;"],["\xA9","&copy;"],["\xAE","&reg;"]],T=[["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"]];function st(n){return n.replace(/\r\n/g,`
`)}function at(n){return n.replace(/^</,"").replace(/([^<][!?/])?>$/,"").replace(/\s+/g," ").trim()}function lt(n,t){for(let e=n.length-1;e>=0;e--)if(t(n[e],e,n))return e;return-1}function M(n){return encodeURIComponent(n)}function U(n){return decodeURIComponent(n)}function ut(n){for(let t=0;t<I.length;t++)n=n.replace(new RegExp(I[t][0],"g"),I[t][1]);return n}function W(n){for(let t=I.length-1;t>=0;t--)n=n.replace(new RegExp(I[t][1],"g"),I[t][0]);return n}function ft(n){for(let t=0;t<T.length;t++)n=n.replace(new RegExp(T[t][0],"g"),T[t][1]);return n}function ct(n){return n.replace(/<!--([\s\S]*?)-->/g,function(...t){return`<!-->${M(t[1])}</!-->`})}function ht(n){return n.replace(/(<script(?:[\s\S]*?)>)([\s\S]*?)(<\/script>)/g,function(...t){return`${t[1]}${M(t[2])}${t[3]}`})}function pt(n){return n.replace(/(<style(?:[\s\S]*?)>)([\s\S]*?)(<\/style>)/g,function(...t){return`${t[1]}${M(t[2])}${t[3]}`})}function gt(n){return n.replace(/(>)([\s\S]*?)(<)/g,function(...t){return`${t[1]}${ut(t[2])}${t[3]}`})}function dt(n){function t(...e){return`=${M(e[1])} `}return n.replace(/='([^'>]*?)'/g,t).replace(/="([^">]*?)"/g,t)}function mt(n,t){let e=t.split("="),r=e.shift();r&&(e.length===0?n[r]=!0:n[r]=U(e.join("=")))}function yt(n){let t=at(n).split(/\s/),e={tag:t[0]||"",attributes:{},children:[],isClosing:!1,isClosed:!1,isEncoded:!1};typeof e.tag=="string"&&(e.isClosing=/^\//.test(e.tag),e.isClosed=e.isClosing,e.tag=e.tag.replace(/^\//,""),!e.isClosing&&["script","style","!--"].indexOf(e.tag)>-1&&(e.isEncoded=!0));for(let r=1;r<t.length;r++)mt(e.attributes,t[r]);return e}function wt(n){let t="";for(let[e,r]of Object.entries(n))typeof r=="string"?t+=` ${e}="${ft(r)}"`:r===!0&&(t+=` ${e}`);return t}function z(n){n=dt(gt(pt(ht(ct(st(n))))));let t=0,e=/<[^>]*?>/g,r,s=[],a=[],o;for(;r=e.exec(n);){if(t!==r.index){let i=n.substring(t,r.index);s.push({content:W(i)})}if(o=yt(r[0]),!o.isClosing)s.push(o),a.push(o);else{let i=lt(s,function(l){return!l.isClosed&&l.tag===o.tag});if(i>-1){let l=s[i];l.isClosed=!0,l.children=s.splice(i+1,s.length-i+1)}}t=e.lastIndex}if(t<n.length){let i=n.substring(t);s.push({content:W(i)})}for(let i of a){if(i.tag&&(i.tag.toUpperCase()==="!DOCTYPE"?i.closer="":i.tag.toLowerCase()==="?xml"?i.closer="?":i.tag==="!--"?i.closer="--":i.isClosed||(i.closer=" /"),i.isEncoded&&i.children))for(let l of i.children)l.content&&(l.content=U(l.content));delete i.isClosed,delete i.isClosing,delete i.isEncoded}return{children:s}}function F(n,t){let e=0,r=function(s){let{tag:a,closer:o,attributes:i,content:l}=t?t(s,e):s,u="";if(e++,typeof a=="string"){if(u+=`<${a}`,typeof i=="object"&&(u+=wt(i)),typeof o!="string"&&(u+=">"),Array.isArray(s.children))for(let c of s.children)u+=r(c);typeof o!="string"?u+=`</${a}>`:u+=`${o}>`}else if(typeof l=="string")u=l;else if(Array.isArray(s.children))for(let c of s.children)u+=r(c);return u};return r(n)}function H(n){let t=function(e){let r=e.split(/([>\s])/).map(o=>o?.trim()).filter(Boolean),s=[],a;for(let o of r){if(o===">"){a=o;continue}let i=a&&a===">"?1:void 0,l={$and:[]},u=o.match(/^([a-zA-Z0-9]+)/),c=[...o.matchAll(/#([a-zA-Z0-9_-]+)/g)],g=[...o.matchAll(/\.([a-zA-Z0-9_-]+)/g)],$=[...o.matchAll(/\[([a-zA-Z0-9_-]+)([*^$]?=["']?([^"']+)["']?)?\]/g)];if(u){let f=u[1];f!=="*"?l.$and.push({tag:f}):l.$and.push({tag:{$regex:f}})}if(c.length>0)for(let f of c)l.$and.push({"attributes.id":{$regex:"(^| )("+f[1]+")( |$)"}});if(g.length>0)for(let f of g)l.$and.push({"attributes.class":{$regex:"(^| )("+f[1]+")( |$)"}});if($.length>0)for(let f of $){let h=f[1],y=f[2]?f[2][0]:null,x=f[3],m={};y?y==="="?m["attributes."+h]=x:y==="^"?m["attributes."+h]={$regex:`^${x}`}:y==="$"?m["attributes."+h]={$regex:`${x}$`}:y==="*"&&(m["attributes."+h]={$regex:x}):m["attributes."+h]={$exists:!0},l.$and.push(m)}i?s.push({query:l,depth:i}):s.push({query:l}),a=o}return s};return n.split(",").map(e=>e.trim()).filter(Boolean).map(e=>t(e))}var vt=class P{constructor(t){this.children=[],typeof t=="string"&&(t=z(t)),Object.assign(this,t),this.children=this.prepare(this.children)}getContent(){let t="";if(typeof this.content=="string")t+=this.content;else for(let e of this.children)t+=e.getContent();return t}setContent(t){return this.children=this.prepare([{content:t}]),this}findOne(t,e=Number.POSITIVE_INFINITY){if(!(e<1))for(let r of this.children){if(_(r,t))return r;let s=r.findOne(t,e-1);if(s)return s}}findMany(t,e=Number.POSITIVE_INFINITY){let r=[];if(e<1)return r;for(let s of this.children){_(s,t)&&r.push(s);let a=s.findMany(t,e-1);r.push(...a)}return r}querySelector(t){let e=H(t);for(let r of e){let s=[this];for(let{query:a,depth:o}of r)s=s.reduce((i,l)=>[...i,...l.findMany(a,o)],[]);if(s[0])return s[0]}}querySelectorAll(t){let e=H(t),r=[];for(let s of e){let a=[this];for(let{query:o,depth:i}of s)a=a.reduce((l,u)=>[...l,...u.findMany(o,i)],[]);r.push(...a)}return r=r.filter((s,a,o)=>o.findIndex(i=>s==i)===a),r}update(t){return it(this,t),this.children=this.prepare(this.children),this}updateOne(t,e){let r=this.findOne(t);return r&&r.update(e),this}updateMany(t,e){let r=this.findMany(t);for(let s of r)s.update(e);return this}prepare(t){return t.map(e=>{if(e instanceof P)return e.parent=this,e;{let r=new P(e);return r.parent=this,r}})}replace(...t){return this.children=this.prepare(t),this}append(...t){return this.children=this.children.concat(this.prepare(t)),this}prepend(...t){return this.children.splice(0,0,...this.prepare(t)),this}insert(t,...e){return t=Math.floor(Z(t,0,this.children.length)),this.children.splice(t,0,...this.prepare(e)),this}toObject(){let t=N(this);return delete t.parent,t.children=this.children.map(e=>e.toObject()),t}toString(t){return F(this,t)}static{this.parse=z}static{this.stringify=F}};G.use(xt());var Y=new $t;Y.setCookieSync("over18=yes","https://novel18.syosetu.com/");Y.setCookieSync("over18=off","https://syosetu.org/");var bt=At(fetch,Y);async function V(n,t,e=0){let r=0;for(;r<=e;){let s=await n.$(t);if(s)return s;await E(256),r+=256}throw new Error(`Element not found: ${t}`)}async function Ct(n,t,e=0){let r=await V(n,t,e);return await n.evaluate(a=>a?.textContent,r)}async function K(n,t,e=0){await V(n,t,e),await n.click(t)}async function J(n,t,e,r=0){let s=0;for(;s<=r;){let a=await Ct(n,t);if(a&&e(a))return a;await E(256),s+=256}throw new Error(`Content not found: ${t}`)}var b=class{constructor(t){this.isOpened=!1,this.cacheDir=".puppeteer",Object.assign(this,t)}async open(){for(this.isOpened||(this.isOpened=!0,this.browser=await G.launch({userDataDir:this.cacheDir}));!this.browser;)await E(128)}async close(){if(this.isOpened){for(;!this.browser;)await E(128);let t=this.browser;this.browser=void 0,this.isOpened=!1,await t.close()}}async load(t,e,r){if(e||(e=[]),await this.open(),!this.browser)throw new Error("Browser not found");let s=await this.browser.newPage();try{await s.goto(t,this.pageOptions);for(let i of e){let l=setTimeout(()=>{throw new Error(`Element not found: ${i}`)},1e4);await s.waitForSelector(i,{visible:!0,timeout:0}),clearTimeout(l)}r&&await r(s);let a=await s.content(),o=D.load(a);return await s.close(),o}catch(a){throw await s.close(),a}}async fetch(t,e){let r=await bt(t,e);if(!r.ok){let o=new Error(r.statusText);throw o.status=r.status,o}let s=await r.text();return D.load(s)}};function Q(n){return typeof n=="number"?n:typeof n=="string"?isNaN(parseInt(n))?0:parseInt(n):0}function p(n){return v(n.find("br").replaceWith(`
`).end().text()).trim()}var S=class extends b{constructor(t){super(t)}async getMetadata(t,e){let r=`https://www.alphapolis.co.jp/novel/${t}/${e}`,s=await this.fetch(r),a=s("table.detail"),o=function(m){return p(a.find("th").filter(function(){return s(this).text().trim()===m}).next())},i=/連載中/.test(p(s(".content-statuses").first())),l=p(s("h1.title")),u=p(s(".author a").first()),c=p(s(".abstract").first()),g=o("\u521D\u56DE\u516C\u958B\u65E5\u6642").replace(/[^0-9]/g,""),$=o("\u66F4\u65B0\u65E5\u6642").replace(/[^0-9]/g,""),f=g.length===12?X(g,"YYYYMMDDHHmm").valueOf():0,h=$.length===12?X($,"YYYYMMDDHHmm").valueOf():0,y=[];for(let m of s("div.episode a").toArray()){let R=m.attribs.href,q=R.split("/").pop();if(!q)throw new Error(`ChapterID not found: ${R}`);y.push(q)}return{onGoing:i,title:l,outline:c,author:u,chapterIds:y,createdAt:f,updatedAt:h}}async getChapter(t,e,r){let s=`https://www.alphapolis.co.jp/novel/${t}/${e}/episode/${r}`,a=await this.load(s,null,async u=>{let c=0;for(;c<10;){c++;try{await K(u,"#TopLayer",0)}catch{}try{await J(u,"#novelBody",g=>v(g).trim()!=="",1e3);return}catch{}}throw new Error("Content not found")}),o=p(a(".episode-title")),i=a("#novelBody").find("br").replaceWith(`
`).end().text();return{id:r,title:o,content:i}}async getBook(t,e,r){let s=await this.getMetadata(t,e),a=[],o=s.chapterIds.length;for(let l=0;l<o;l++)try{let u=s.chapterIds[l],c=await this.getChapter(t,e,u);a.push(c),r&&r(null,c,l,o)}catch(u){r&&r(u,null,l,o)}return{...s,chapters:a}}};import tt from"dayjs";var B=class extends b{constructor(t){super(t)}async getMetadata(t){let e=`https://syosetu.org/?mode=ss_detail&nid=${t}`,r=await this.fetch(e),s=function(x){return p(r("td").filter(function(){return r(this).text().trim()===x}).next())},a=!/短編|完結/.test(s("\u8A71\u6570")),o=s("\u30BF\u30A4\u30C8\u30EB"),i=s("\u4F5C\u8005"),l=s("\u3042\u3089\u3059\u3058"),u=parseInt(s("\u8A71\u6570").replace(/[^0-9]/g,"")),c=s("\u63B2\u8F09\u958B\u59CB").replace(/[^0-9]/g,""),g=s("\u6700\u65B0\u6295\u7A3F").replace(/[^0-9]/g,""),$=c.length===12?tt(c,"YYYYMMDDHHmm").valueOf():0,f=g.length===12?tt(g,"YYYYMMDDHHmm").valueOf():0,h=[];for(let x=0;x<u;x++)h.push(""+(x+1));return{onGoing:a,title:o,outline:l,author:i,chapterIds:h,createdAt:$,updatedAt:f}}async getChapter(t,e){let r=`https://syosetu.org/novel/${t}/${e}.html`,s=await this.fetch(r),a=p(s("#analytics_start").prev()),o=0,i=s(`#${o}`),l=[];for(;i.length!==0;)l.push(i.text()),o++,i=s(`#${o}`);return{id:e,title:a,content:l.join(`
`)}}async getBook(t,e){let r=await this.getMetadata(t),s=[],a=r.chapterIds.length;for(let i=0;i<a;i++)try{let l=r.chapterIds[i],u=await this.getChapter(t,l);s.push(u),e&&e(null,u,i,a)}catch(l){e&&e(l,null,i,a)}return{...r,chapters:s}}};import It from"dayjs";var j=class extends b{constructor(t){super(t)}async getMetadata(t){let e=`https://kakuyomu.jp/works/${t}`,r=await this.fetch(e),s=p(r("a[title]").first()),a=p(r(".CollapseTextWithKakuyomuLinks_collapseText__XSlmz")),o=p(r('a[href^="/users"]').first()),i=!1;for(let f of r(".Meta_metaItem__8eZTP").toArray()){let h=r(f).text();if(h.indexOf("\u9023\u8F09\u4E2D")>-1){i=!0;break}else if(h.indexOf("\u5B8C\u7D50\u6E08")>-1){i=!1;break}}let l=0,u=0,c=[],g=JSON.parse(r("#__NEXT_DATA__").text());for(let f of Object.values(g.props.pageProps.__APOLLO_STATE__))if(w(f)&&f.__typename==="Episode"){let h=It(f.publishedAt).valueOf();l?l>h&&(l=h):l=h,u?u<h&&(u=h):u=h,c.push({id:f.id,publishedAt:h})}return{onGoing:i,title:s,outline:a,author:o,chapterIds:c.map(f=>f.id),createdAt:l,updatedAt:u}}async getChapter(t,e){let r=`https://kakuyomu.jp/works/${t}/episodes/${e}`,s=await this.fetch(r),a=p(s("#contentMain-header .widget-episodeTitle")),o=1,i=s(`#p${o}`),l=[];for(;i.length!==0;)l.push(i.text()),o++,i=s(`#p${o}`);return{id:e,title:a,content:l.join(`
`)}}async getBook(t,e){let r=await this.getMetadata(t),s=[],a=r.chapterIds.length;for(let i=0;i<a;i++)try{let l=r.chapterIds[i],u=await this.getChapter(t,l);s.push(u),e&&e(null,u,i,a)}catch(l){e&&e(l,null,i,a)}return{...r,chapters:s}}};import et from"dayjs";var k=class extends b{constructor(t){super(t)}async getMetadata(t){let e=`https://ncode.syosetu.com/novelview/infotop/ncode/${t}/`,r=await this.fetch(e),s=!1,a=!0,o=p(r("#pre_info"));o.indexOf("\u77ED\u7DE8")>-1?(s=!0,a=!1):o.indexOf("\u5B8C\u7D50\u6E08")>-1?(s=!1,a=!1):(s=!1,a=!0);let i=p(r("#contents_main > h1 > a")),l=p(r("#noveltable1 tbody tr:nth-child(2) td")),u=p(r("#noveltable1 tbody tr:nth-child(1) td")),c=p(r("#noveltable2 tbody tr:nth-child(1) td")).replace(/[^0-9]/g,""),g=p(r("#noveltable2 tbody tr:nth-child(2) td")).replace(/[^0-9]/g,""),$=c.length===12?et(c,"YYYYMMDDHHmm").valueOf():0,f=s?$:g.length===12?et(g,"YYYYMMDDHHmm").valueOf():0,h=Q(v(r("#pre_info").text()).match(/全([0-9]+)エピソード/)?.[1]||""),y=[];if(s)y.push("");else for(let m=0;m<h;m++)y.push(""+(m+1));return{onGoing:a,title:i,outline:u,author:l,chapterIds:y,createdAt:$,updatedAt:f}}async getChapter(t,e){let r=e===""?`https://ncode.syosetu.com/${t}`:`https://ncode.syosetu.com/${t}/${e}`,s=await this.fetch(r),a=p(s("h1.p-novel__title")),o=1,i=s(`#L${o}`),l=[];for(;i.length!==0;)l.push(i.text()),o++,i=s(`#L${o}`);return{id:e,title:a,content:l.join(`
`)}}async getBook(t,e){let r=await this.getMetadata(t),s=[],a=r.chapterIds.length;for(let i=0;i<a;i++)try{let l=r.chapterIds[i],u=await this.getChapter(t,l);s.push(u),e&&e(null,u,i,a)}catch(l){e&&e(l,null,i,a)}return{...r,chapters:s}}};var le={NAROU:"narou",KAKUYOMU:"kakuyomu",ALPHAPOLIS:"alphapolis",HAMELN:"hameln"};function fe(n,t,e){let r="";if(n==="narou")r=`https://ncode.syosetu.com/${t}/`,e&&e!==""&&(r+=`${e}`);else if(n==="narou18")r=`https://novel18.syosetu.com/${t}/`,e&&(r+=`${e}`);else if(n==="kakuyomu")r=`https://kakuyomu.jp/works/${t}`,e&&(r+=`/episodes/${e}`);else if(n==="hameln")r=`https://syosetu.org/novel/${t}/`,e&&(r+=`${e}.html`);else if(n==="alphapolis")r=`https://www.alphapolis.co.jp/novel/${t}/`,e&&(r+=`episode/${e}`);else throw new Error(`Invalid provider: ${n}`);return r}function ce(n){let t=[["narou",/^https?:\/\/(?:www\.)?ncode\.syosetu\.com\/(?!novelview)([^/]+)(?:$|\/)/],["narou",/^https?:\/\/(?:www\.)?novel18\.syosetu\.com\/(?!novelview)([^/]+)(?:$|\/)/],["kakuyomu",/^https?:\/\/(?:www\.)?kakuyomu\.jp\/works\/([^/]+)(?:$|\/)/],["hameln",/^https?:\/\/(?:www\.)?syosetu.org\/novel\/([^/]+)(?:$|\/)/],["alphapolis",/^https?:\/\/(?:www\.)?alphapolis\.co\.jp\/novel\/([^/]+\/[^/]+)(?:$|\/)/]],e=n.split(/\s/).map(s=>s.trim()).filter(Boolean),r=[];for(let s of e)for(let[a,o]of t)if(o.test(s)){let i=s.match(o);if(!i||!i[0]||!i[1])continue;let l=i[0];a==="kakuyomu"&&(l=l.replace(/\/$/,"")),r.push({url:l,provider:a,id:i[1]})}return r}var d={narou:new k,kakuyomu:new j,alphapolis:new S,hameln:new B};async function ye(n){d.narou.cacheDir=n,d.kakuyomu.cacheDir=n,d.alphapolis.cacheDir=n,d.hameln.cacheDir=n}async function we(n,t){let e;if(n==="narou")e=await d.narou.getMetadata(t);else if(n==="kakuyomu")e=await d.kakuyomu.getMetadata(t);else if(n==="alphapolis")e=await d.alphapolis.getMetadata(t.split("/")[0],t.split("/")[1]);else if(n==="hameln")e=await d.hameln.getMetadata(t);else throw new Error(`Invalid provider: ${n}`);if(e.title.trim()==="")throw new Error("Title not found");if(e.author.trim()==="")throw new Error("Author not found");return e}async function xe(n,t,e){let r;if(n==="narou")r=await d.narou.getChapter(t,e);else if(n==="kakuyomu")r=await d.kakuyomu.getChapter(t,e);else if(n==="alphapolis")r=await d.alphapolis.getChapter(t.split("/")[0],t.split("/")[1],e);else if(n==="hameln")r=await d.hameln.getChapter(t,e);else throw new Error(`Invalid provider: ${n}`);if(r.title.trim()==="")throw new Error("Title not found");return r}async function $e(n,t,e){let r;if(n==="narou")r=await d.narou.getBook(t,e);else if(n==="kakuyomu")r=await d.kakuyomu.getBook(t,e);else if(n==="alphapolis")r=await d.alphapolis.getBook(t.split("/")[0],t.split("/")[1],e);else if(n==="hameln")r=await d.hameln.getBook(t,e);else throw new Error(`Invalid provider: ${n}`);if(r.title.trim()==="")throw new Error("Title not found");if(r.author.trim()==="")throw new Error("Author not found");return r}async function Ae(){for(let n of Object.values(d))await n.close()}export{le as PROVIDER,Ae as close,fe as createURL,$e as getBook,xe as getChapter,we as getMetadata,ce as parseURL,ye as setCacheDir};
